FROM golang:1.19.1-alpine3.16 as builder
LABEL description="mawinter-register scripts"

COPY cmd/ /app/cmd/
COPY internal/ /app/internal/
COPY go.mod /app/go.mod
WORKDIR /app
RUN go mod tidy
RUN go build -a -tags "netgo" -installsuffix netgo  -ldflags="-s -w -extldflags \"-static\"" -o bin/ ./...

FROM gcr.io/distroless/static-debian11
COPY --from=builder /app/bin/mawinter /usr/local/bin/mawinter
ENTRYPOINT ["/usr/local/bin/mawinter-register", "bill"]
